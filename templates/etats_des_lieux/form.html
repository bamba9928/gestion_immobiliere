{% extends "base.html" %}
{% load static %}
{% load tailwind_tags %}

{% block title %}État des lieux | MADA IMMO{% endblock %}

{% block extra_css %}
<style>
    /* Force le style Dark Mode sur les widgets Django par défaut */
    input[type="text"],
    input[type="number"],
    input[type="date"],
    select,
    textarea {
        width: 100%;
        background-color: #0a0a0a; /* neutral-950 */
        border: 1px solid #262626; /* neutral-800 */
        border-radius: 0.75rem; /* rounded-xl */
        padding: 0.75rem 1rem;
        color: white;
        transition: all 0.2s;
        outline: none;
    }

    input:focus, select:focus, textarea:focus {
        border-color: {% if type_etat == "ENTREE" %}#10b981{% else %}#f59e0b{% endif %};
        box-shadow: 0 0 0 1px {% if type_etat == "ENTREE" %}rgba(16, 185, 129, 0.2){% else %}rgba(245, 158, 11, 0.2){% endif %};
    }

    /* Style spécifique pour les fichiers */
    input[type="file"] {
        background-color: #171717;
        padding: 0.5rem;
        font-size: 0.875rem;
        border-radius: 0.5rem;
        color: #a3a3a3;
    }
    input[type="file"]::file-selector-button {
        background-color: #262626;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        margin-right: 1rem;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    input[type="file"]::file-selector-button:hover {
        background-color: #404040;
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-10">

    <div class="mb-8">
        <a href="{% url 'bail_detail' bail.id %}" class="inline-flex items-center gap-2 text-sm text-neutral-400 hover:text-white transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>
            Retour au bail
        </a>
    </div>

    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8">
        <div>
            <div class="flex items-center gap-3 mb-2">
                <span class="px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider
                             {% if type_etat == 'ENTREE' %}
                                bg-emerald-500/10 text-emerald-500 border border-emerald-500/20
                             {% else %}
                                bg-amber-500/10 text-amber-500 border border-amber-500/20
                             {% endif %}">
                    {% if type_etat == "ENTREE" %}Entrée{% else %}Sortie{% endif %}
                </span>
                <span class="text-neutral-500 text-sm font-medium">{{ bail.bien.get_type_bien_display }}</span>
            </div>
            <h1 class="text-3xl font-bold text-white">État des lieux</h1>
            <p class="text-neutral-400 mt-1">
                Bien : <span class="text-white font-medium">{{ bail.bien.titre }}</span>
            </p>
        </div>

        <div class="flex items-center gap-4 bg-neutral-900/50 p-4 rounded-xl border border-neutral-800">
            <div class="h-10 w-10 rounded-full bg-neutral-800 flex items-center justify-center text-neutral-400 font-bold border border-neutral-700">
                {{ bail.locataire.username|make_list|first|upper }}
            </div>
            <div>
                <p class="text-xs text-neutral-500 uppercase font-bold">Locataire</p>
                <p class="text-sm text-white font-medium">{{ bail.locataire.get_full_name|default:bail.locataire.username }}</p>
            </div>
        </div>
    </div>

    <div class="bg-neutral-900 border border-neutral-800 rounded-2xl p-6 md:p-8 shadow-2xl">
        <form method="post" enctype="multipart/form-data" class="space-y-8">
            {% csrf_token %}

            {% if form.non_field_errors %}
                <div class="p-4 rounded-xl bg-red-500/10 border border-red-500/20 text-red-400 text-sm">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}

            <div class="space-y-6">
                {% for field in form %}
                    <div class="space-y-2 group">
                        <label for="{{ field.id_for_label }}" class="block text-xs font-bold uppercase tracking-wider text-neutral-500 group-focus-within:text-white transition-colors">
                            {{ field.label }} {% if field.field.required %}<span class="text-red-500">*</span>{% endif %}
                        </label>

                        <div class="relative">
                            {{ field }}
                        </div>

                        {% if field.help_text %}
                            <p class="text-xs text-neutral-500">{{ field.help_text }}</p>
                        {% endif %}

                        {% if field.errors %}
                            <ul class="text-xs text-red-400 space-y-1 mt-1">
                                {% for error in field.errors %}
                                    <li class="flex items-center gap-1">
                                        <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                        {{ error }}
                                    </li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>

            <div class="pt-6 border-t border-neutral-800 flex items-center justify-end gap-4">
                <a href="{% url 'bail_detail' bail.id %}"
                   class="px-6 py-2.5 rounded-xl border border-neutral-700 text-neutral-300 hover:text-white hover:bg-neutral-800 transition-all text-sm font-medium">
                    Annuler
                </a>

                <button type="submit"
                        class="px-6 py-2.5 rounded-xl text-white font-bold text-sm shadow-lg transform hover:-translate-y-0.5 transition-all duration-200
                               {% if type_etat == 'ENTREE' %}
                                    bg-emerald-600 hover:bg-emerald-500 shadow-emerald-900/20
                               {% else %}
                                    bg-amber-600 hover:bg-amber-500 shadow-amber-900/20
                               {% endif %}">
                    Enregistrer l'état des lieux
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}