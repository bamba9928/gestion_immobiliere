<!DOCTYPE html>
{% load static %}
<html lang="fr">
<head>
    <meta charset="UTF-8">

    <style>
        @page {
            size: A4;
            margin: 2cm;
            @bottom-right {
                content: "Page " counter(page) " sur " counter(pages);
                font-size: 9pt;
            }
        }

        body {
            font-family: Helvetica, sans-serif;
            color: #333;
            line-height: 1.5;
            font-size: 11pt;
            position: relative;
        }

        /* FILIGRANE EN ARRIÈRE-PLAN */
        body::before {
            content: "MADA IMMO";
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 80pt;
            font-weight: bold;
            color: rgba(0, 0, 0, 0.05);
            letter-spacing: 0.1em;
            z-index: -1;
            white-space: nowrap;
            pointer-events: none;
        }

        /* HEADER LOGO + TITRE (table = très compatible WeasyPrint) */
        .header { margin-bottom: 14px; }
        .header-table {
            width: 100%;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
            border-collapse: collapse;
        }
        .logo-cell { width: 120px; vertical-align: middle; }
        .logo { width: 110px; height: auto; }
        .title-cell { text-align: center; vertical-align: middle; }
        .doc-title { font-size: 18pt; font-weight: bold; margin: 0; }
        .doc-subtitle { font-size: 10pt; margin-top: 4px; color: #444; }

        /* SECTIONS */
        .section-title {
            background: #f0f0f0;
            padding: 6px 8px;
            font-weight: bold;
            margin-top: 18px;
            text-transform: uppercase;
            border: 1px solid #ddd;
        }

        .clause-content {
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-top: none;
            background: #fafafa;
        }
        .clause-content p { margin: 0 0 10px 0; }
        .clause-content p:last-child { margin-bottom: 0; }

        /* SIGNATURES */
        .signature-box {
            margin-top: 45px;
            width: 100%;
        }
        .signature-table {
            width: 100%;
            border-collapse: collapse;
        }
        .signature {
            border: 1px solid #ccc;
            width: 48%;
            height: 120px;
            padding: 10px;
            text-align: center;
            vertical-align: top;
            font-size: 10pt;
        }
        .muted { color: #444; font-size: 9pt; font-style: italic; }

        /* Petites lignes info */
        .info p { margin: 0 0 6px 0; }
    </style>
</head>

<body>

    <div class="header">
        <table class="header-table">
            <tr>
                <td class="logo-cell">
                    {# Remplacez le chemin si besoin #}
                    <img class="logo" src="{% static 'img/logo-mada-immo.png' %}" alt="MADA IMMO">
                </td>
                <td class="title-cell">
                    <div class="doc-title">CONTRAT DE BAIL À USAGE D'HABITATION</div>
                    <div class="doc-subtitle">MADA IMMO - Référence : #{{ bail.id }}</div>
                </td>
            </tr>
        </table>
    </div>

    <div class="section-title">ARTICLE 1 - LES PARTIES</div>
    <div class="clause-content info">
        <p><strong>LE BAILLEUR :</strong> {{ bail.bien.proprietaire.get_full_name }}</p>
        <p><strong>LE LOCATAIRE :</strong> {{ bail.locataire.get_full_name }} (CNI : {{ bail.locataire.profile.cni_numero }})</p>
    </div>

    <div class="section-title">ARTICLE 2 - DÉSIGNATION DU BIEN LOUÉ</div>
    <div class="clause-content info">
        <p><strong>Désignation :</strong> {{ bail.bien.titre }} ({{ bail.bien.type_bien }})</p>
        <p><strong>Adresse :</strong> {{ bail.bien.adresse }}, {{ bail.bien.ville }}</p>
        <p><strong>Surface :</strong> {{ bail.bien.surface }} m²</p>
    </div>

    <div class="section-title">ARTICLE 3 - DURÉE DU BAIL</div>
    <div class="clause-content info">
        <p><strong>Prise d'effet :</strong> {{ bail.date_debut|date:"d/m/Y" }}</p>
        <p><strong>Fin de bail :</strong> {{ bail.date_fin|date:"d/m/Y" }}</p>
    </div>

    <div class="section-title">ARTICLE 4 - DÉPÔT DE GARANTIE</div>
    <div class="clause-content info">
        <p>
            Le locataire verse à la signature du présent contrat un dépôt de garantie d'un montant de
            <strong>{{ bail.depot_garantie|floatformat:0 }} FCFA</strong>.
        </p>
    </div>

    <div class="section-title">ARTICLE 5 - LOYER ET CHARGES</div>
    <div class="clause-content">
        {% with charges=bail.montant_charges|default_if_none:0 %}
        {% with total=bail.montant_loyer|add:charges %}
        <p>
            Le présent bail est consenti et accepté moyennant un loyer mensuel principal de
            <strong>{{ bail.montant_loyer|floatformat:0 }} FCFA</strong>,
            auquel s'ajoute une provision sur charges de
            <strong>{{ charges|floatformat:0 }} FCFA</strong>,
            soit un montant total dû de <strong>{{ total|floatformat:0 }} FCFA</strong> par mois.
        </p>
        {% endwith %}
        {% endwith %}

        <p>
            Le loyer et les charges sont payables d'avance, au plus tard le
            <strong>{{ bail.jour_paiement }} de chaque mois</strong>.
            Le paiement sera effectué par tout moyen légal convenu entre les parties (Virement, Chèque
            ou Paiement via la plateforme MADA IMMO).
        </p>

        <p class="muted">
            * Toute somme non payée à son échéance portera de plein droit intérêt au taux légal en vigueur,
            après mise en demeure restée infructueuse pendant 48 heures.
        </p>
    </div>

    <div class="signature-box">
        <table class="signature-table">
            <tr>
                <td class="signature">
                    Mention "Lu et approuvé"<br><br>
                    <strong>Le Bailleur</strong><br><br><br>
                    Signature :
                </td>
                <td style="width:4%"></td>
                <td class="signature">
                    Mention "Lu et approuvé"<br><br>
                    <strong>Le Locataire</strong><br><br><br>
                    Signature :
                </td>
            </tr>
        </table>
    </div>

</body>
</html>