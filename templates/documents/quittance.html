<!DOCTYPE html>
{% load static %}
{% load humanize %}
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Contrat de Bail - {{ bail.bien.titre }}</title>
    <style>
        /* Configuration de la page A4 */
        @page {
            size: A4;
            margin: 2cm;
            margin-bottom: 2.5cm; /* Espace pour le footer */
            @bottom-right {
                content: "Page " counter(page) " sur " counter(pages);
                font-family: 'Helvetica', sans-serif;
                font-size: 8pt;
                color: #6b7280;
            }
        }

        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            font-size: 10pt;
            color: #1f2937; /* neutral-800 */
            line-height: 1.5;
        }

        /* --- EN-TÊTE --- */
        .header-table {
            width: 100%;
            border-bottom: 2px solid #10b981; /* emerald-500 */
            padding-bottom: 15px;
            margin-bottom: 30px;
        }
        .company-name {
            font-size: 18pt;
            font-weight: bold;
            color: #10b981;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .company-sub {
            font-size: 8pt;
            color: #6b7280;
            margin-top: 2px;
        }
        .doc-title {
            font-size: 16pt;
            font-weight: bold;
            text-align: right;
            text-transform: uppercase;
            color: #111;
        }
        .doc-meta {
            text-align: right;
            font-size: 9pt;
            color: #4b5563;
            margin-top: 5px;
        }

        /* --- TITRES --- */
        h2 {
            font-size: 11pt;
            text-transform: uppercase;
            color: #064e3b; /* emerald-900 */
            background-color: #ecfdf5; /* emerald-50 */
            padding: 8px 10px;
            border-left: 4px solid #10b981;
            margin-top: 25px;
            margin-bottom: 15px;
            page-break-after: avoid;
        }

        /* --- TABLES DE CONTENU --- */
        table.content-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }
        .content-table td {
            vertical-align: top;
            padding: 4px 0;
        }
        .label {
            font-weight: bold;
            color: #374151; /* neutral-700 */
            width: 35%;
        }
        .value {
            color: #000;
        }

        /* --- BLOCS PARTIES (Bailleur/Locataire) --- */
        .party-box {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 12px;
            height: 90px;
        }
        .party-title {
            font-size: 8pt;
            font-weight: bold;
            color: #10b981;
            text-transform: uppercase;
            margin-bottom: 5px;
            display: block;
        }
        .party-name {
            font-size: 11pt;
            font-weight: bold;
            display: block;
            margin-bottom: 2px;
        }

        /* --- TABLEAU FINANCIER --- */
        .financial-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            border: 1px solid #d1d5db;
        }
        .financial-table th, .financial-table td {
            padding: 8px 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        .financial-table tr:last-child td {
            background-color: #f0fdf4; /* emerald-50 */
            border-top: 2px solid #10b981;
            font-weight: bold;
            color: #064e3b;
        }
        .amount {
            text-align: right;
            font-family: 'Courier New', Courier, monospace;
        }

        /* --- TEXTE JURIDIQUE --- */
        p {
            text-align: justify;
            margin-bottom: 8px;
            font-size: 9.5pt;
        }
        .clause-title {
            font-weight: bold;
            color: #111;
            text-decoration: underline;
        }

        /* --- SIGNATURES --- */
        .signatures-section {
            margin-top: 40px;
            page-break-inside: avoid;
        }
        .signature-box {
            width: 48%;
            border: 1px solid #9ca3af;
            height: 120px;
            padding: 10px;
            font-size: 9pt;
        }

        /* --- FOOTER FIXE --- */
        .footer {
            position: fixed;
            bottom: -1.5cm;
            left: 0;
            right: 0;
            height: 1cm;
            text-align: center;
            font-size: 7pt;
            color: #9ca3af;
            border-top: 1px solid #e5e7eb;
            padding-top: 5px;
        }
    </style>
</head>
<body>

    <table class="header-table">
        <tr>
            <td style="vertical-align: top;">
                <div class="company-name">MADA IMMO</div>
                <div class="company-sub">Gestion Immobilière &amp; Syndic</div>
            </td>
            <td style="vertical-align: top;">
                <div class="doc-title">CONTRAT DE BAIL</div>
                <div class="doc-meta">Réf : {{ bail.reference|default:bail.id }}</div>
                <div class="doc-meta">Dakar, le {% now "d F Y" %}</div>
            </td>
        </tr>
    </table>

    <h2>1. Désignation des Parties</h2>
    <table style="width: 100%; margin-bottom: 20px;">
        <tr>
            <td width="48%" style="padding-right: 10px;">
                <div class="party-box">
                    <span class="party-title">LE BAILLEUR (PROPRIÉTAIRE)</span>
                    <span class="party-name">{{ bail.bien.proprietaire.get_full_name|default:bail.bien.proprietaire.username|upper }}</span>
                    <span style="font-size: 8pt; color: #555;">Représenté par l'agence MADA IMMO</span>
                </div>
            </td>
            <td width="48%" style="padding-left: 10px;">
                <div class="party-box">
                    <span class="party-title">LE PRENEUR (LOCATAIRE)</span>
                    <span class="party-name">{{ bail.locataire.get_full_name|default:bail.locataire.username|upper }}</span>
                    <div style="font-size: 8pt; margin-top: 4px;">
                        CNI/Passeport : {{ bail.locataire.profile.cni_numero|default:"Non renseigné" }}<br>
                        Tél : {{ bail.locataire.profile.telephone|default:"Non renseigné" }}
                    </div>
                </div>
            </td>
        </tr>
    </table>

    <h2>2. Objet du Contrat</h2>
    <p>Le Bailleur donne en location au Preneur, qui accepte, les locaux désignés ci-après :</p>
    <table class="content-table">
        <tr>
            <td class="label">Adresse du bien :</td>
            <td class="value">{{ bail.bien.adresse }}, {{ bail.bien.ville }}</td>
        </tr>
        <tr>
            <td class="label">Type de bien :</td>
            <td class="value">{{ bail.bien.get_type_bien_display }}</td>
        </tr>
        <tr>
            <td class="label">Consistance :</td>
            <td class="value">{{ bail.bien.nb_pieces }} pièce(s) - Surface approx. {{ bail.bien.surface }} m²</td>
        </tr>
        <tr>
            <td class="label">Usage :</td>
            <td class="value">Habitation Principale</td>
        </tr>
    </table>

    <h2>3. Durée du Bail</h2>
    <table class="content-table">
        <tr>
            <td class="label">Date de prise d'effet :</td>
            <td class="value"><strong>{{ bail.date_debut|date:"d F Y" }}</strong></td>
        </tr>
        {% if bail.date_fin %}
        <tr>
            <td class="label">Date d'expiration :</td>
            <td class="value"><strong>{{ bail.date_fin|date:"d F Y" }}</strong></td>
        </tr>
        {% else %}
        <tr>
            <td class="label">Durée :</td>
            <td class="value">Indéterminée (Tacite reconduction)</td>
        </tr>
        {% endif %}
    </table>

    <h2>4. Conditions Financières</h2>
    <p>Le présent bail est consenti et accepté moyennant un loyer mensuel payable d'avance, au plus tard le <strong>{{ bail.jour_paiement }}</strong> de chaque mois.</p>

    <table class="financial-table">
        <tr>
            <td>Loyer mensuel principal</td>
            <td class="amount">{{ bail.montant_loyer|intcomma }} FCFA</td>
        </tr>
        <tr>
            <td>Provisions sur charges</td>
            <td class="amount">
                {% if bail.montant_charges > 0 %}
                    {{ bail.montant_charges|intcomma }} FCFA
                {% else %}
                    <em>Incluses ou Néant</em>
                {% endif %}
            </td>
        </tr>
        <tr>
            <td><strong>TOTAL MENSUEL À PAYER</strong></td>
            <td class="amount"><strong>{{ bail.montant_loyer|add:bail.montant_charges|intcomma }} FCFA</strong></td>
        </tr>
    </table>

    <div style="margin-top: 15px; padding: 10px; background-color: #f3f4f6; border-radius: 4px; font-size: 9pt;">
        <strong>Dépôt de garantie :</strong> À la signature des présentes, le Preneur verse la somme de <strong>{{ bail.depot_garantie|intcomma }} FCFA</strong> correspondant au dépôt de garantie (Caution).
    </div>

    <h2>5. Obligations Générales</h2>
    <p><span class="clause-title">Paiement :</span> Le loyer est payable par virement bancaire, chèque ou moyens de paiement numériques agréés (Wave, Orange Money) via la plateforme MADA IMMO.</p>
    <p><span class="clause-title">Entretien :</span> Le Preneur prend les lieux dans l'état où ils se trouvent lors de l'entrée en jouissance. Il s'engage à les entretenir en bon père de famille.</p>
    <p><span class="clause-title">Cession et Sous-location :</span> Toute sous-location ou cession de bail est strictement interdite sans l'accord écrit du Bailleur.</p>
    <p><span class="clause-title">Résiliation :</span> Le congé doit être signifié par lettre recommandée avec accusé de réception ou par acte d'huissier, en respectant le préavis légal en vigueur.</p>

    <div class="signatures-section">
        <p style="margin-bottom: 15px;">Fait à <strong>{{ bail.bien.ville }}</strong>, le <strong>{% now "d F Y" %}</strong>, en deux exemplaires originaux.</p>

        <table style="width: 100%; border-collapse: collapse;">
            <tr>
                <td width="50%" style="padding-right: 10px;">
                    <div class="signature-box">
                        <strong>LE BAILLEUR</strong><br>
                        <span style="font-size: 8pt; font-style: italic;">(Lu et approuvé)</span>
                    </div>
                </td>
                <td width="50%" style="padding-left: 10px;">
                    <div class="signature-box">
                        <strong>LE PRENEUR</strong><br>
                        <span style="font-size: 8pt; font-style: italic;">(Lu et approuvé)</span>
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <div class="footer">
        Document généré automatiquement par la plateforme MADA IMMO - www.mada-immo.sn<br>
        Authenticité numérique ID : {{ bail.id }}-{{ now|date:"YmdHis" }}
    </div>

</body>
</html>